var Code2Mind=function(){"use strict";var t;!function(t){t.SPACE=" ",t.TAB="\t",t.SPACE_TAB="  ",t.LINE="\n"}(t||(t={}));var e=function(t,e,i,n,h){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=0),void 0===n&&(n=null),void 0===h&&(h=[]),this.uid=t,this.title=e,this.children=h,this.parentUid=n,this.level=i},i=function(){function t(){}return t.getUUid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},t}(),n=function(){function n(){}return n.parse=function(t){if(void 0===t&&(t=""),t){var h=t.replace(/\r\n/g,"\n").split("\n"),o=new e(i.getUUid());return h.forEach((function(t,e){0===e?o.title=t:n.parseLine(t,o)})),o}return null},n.parseLine=function(t,n){if(void 0===t&&(t=""),t){var h=this.getToken(t,0);if("END"!==h.type&&n.children.length){var o=n.children.length-1;this.parseLine(h.token,n.children[o])}else{var d=new e(i.getUUid(),h.token,n.level+1,n.uid);n.children.push(d)}}},n.getToken=function(e,i){void 0===i&&(i=0);var n=e.charAt(i);return n===t.TAB?{token:e.substring(i+1),type:"TAB"}:n===t.SPACE&&e.charAt(i+1)===t.SPACE?{token:e.substring(i+2),type:"SPACE"}:{token:e.trim(),type:"END"}},n}();!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],h=document.createElement("style");h.type="text/css","top"===i&&n.firstChild?n.insertBefore(h,n.firstChild):n.appendChild(h),h.styleSheet?h.styleSheet.cssText=t:h.appendChild(document.createTextNode(t))}}(".code2mind-main {\n  position: absolute;\n  padding: 10px 50px;\n  line-height: 22px;\n  min-height: 40px;\n  color: #FFFFFF;\n  border-radius: 50%;\n  max-width: 300px;\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  word-break: break-word;\n  text-align: left;\n  font-size: 14px;\n  background: #fa815e;\n  will-change: top, left;\n  box-sizing: border-box;\n  margin: 0 0;\n}\n\n.code2mind-main-item {\n  border-radius: 4px;\n  padding: 10px 20px;\n}\n\n.code2mind-main-item2 {\n  background: transparent;\n  border-radius: 0;\n  color: #999999;\n  border-bottom: 2px solid #999999;\n}\n");var h=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);return function(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}(i,e),i},o=function(t){var e=document.createElement("div"),i="code2mind-main";return t.level>0&&(i+=" code2mind-main-item"),t.level>1&&(i+=" code2mind-main-item2"),e.className=i,e.innerText=t.title,e};return function(){function t(t){if(this.config=Object.assign({heightSpac:50,widthSpac:100,width:0,height:0,lineStyle:{curvature:80,stroke:"#DEDEDE",strokeWidth:2},themes:"default",el:"#code2mind"},t),this.el=document.querySelector(this.config.el),t.width||(this.config.width=this.el.offsetWidth),t.height||(this.config.height=this.el.offsetHeight),!this.el)throw this.config.el+"，对应的dom不存在";this.el.style.position="relative"}return t.prototype.render=function(t){void 0===t&&(t=""),this.el.innerHTML="";var e=n.parse(t);if(e){var i=this.el.cloneNode(!0);i.style.zIndex="-9000",i.style.visibility="hidden",document.body.appendChild(i),this.calcBound(i,e),document.body.removeChild(i),this.layout(e,this.config.width/2-e.bound.width/2,this.config.height/2-e.bound.height/2,!1);var o=h("svg",{style:"position:absolute;left: 0;top: 0",width:"100%",height:"100%"});this.el.appendChild(o),this.drawMind(this.el,e,o)}},t.prototype.drawMind=function(t,e,i){var n=this,d=o(e);if(d.style.top=e.top+"px",d.style.left=e.left+"px",e.children.length){var l=0===e.level?e.left+e.bound.width/2:e.isLeft?e.left:e.left+e.bound.width,c=(0===e.level||1===e.level?e.top+e.bound.height/2:e.top+e.bound.height)-1;e.children.forEach((function(e){var o=e.isLeft?l-n.config.lineStyle.curvature:l+n.config.lineStyle.curvature,d=e.isLeft?e.left+e.bound.width:e.left,r=(1===e.level?e.top+e.bound.height/2:e.top+e.bound.height)-1,a="M "+l+" "+c+" C "+o+" "+c+" "+(e.isLeft?d+n.config.lineStyle.curvature:d-n.config.lineStyle.curvature)+" "+r+" "+d+" "+r,u=h("path",{d:a,stroke:n.config.lineStyle.stroke,"stroke-width":n.config.lineStyle.strokeWidth,fill:"none"});i.append(u),n.drawMind(t,e,i)}))}t.appendChild(d)},t.prototype.layout=function(t,e,i,n){var h=this;if(t.children.length)if(0===t.level){var o=i+t.bound.height/2-t.bound.leftHeight/2,d=i+t.bound.height/2-t.bound.rightHeight/2;t.children.forEach((function(i,n){if(i.isLeft){var l=e-h.config.widthSpac-i.bound.width;o+=0===n?0:t.children[n-2].bound.clientHeight+h.config.heightSpac,h.layout(i,l,o-i.bound.height/2+i.bound.clientHeight/2,!0)}else if(i.isRight){l=e+h.config.widthSpac+t.bound.width;d+=n-1==0?0:t.children[n-2].bound.clientHeight+h.config.heightSpac,h.layout(i,l,d-i.bound.height/2+i.bound.clientHeight/2,!1)}}))}else{var l=e+this.config.widthSpac+t.bound.width;n&&(l=e-this.config.widthSpac);var c=i+t.bound.height/2-t.bound.clientHeight/2;1===t.level&&(c-=t.bound.height/2),t.children.forEach((function(e,i){c+=(0===i?0:t.children[i-1].bound.clientHeight)+(0===i?0:h.config.heightSpac),h.layout(e,n?l-e.bound.width:l,c-e.bound.height/2+e.bound.clientHeight/2,n)}))}n&&(t.isLeft=n),t.top=i,t.left=e},t.prototype.calcBound=function(t,e){var i=this,n={clientWidth:0,clientHeight:0,width:0,height:0,leftWidht:0,leftHeight:0,rightWidth:0,rightHeight:0},h=o(e);t.appendChild(h),n.clientWidth=n.width=h.offsetWidth,n.clientHeight=n.height=h.offsetHeight;var d=e.children.length;if(d){var l=0,c=0,r=0,a=0,u=0,g=0;e.children.forEach((function(n,h){i.calcBound(t,n),0===e.level?h%2==0?(n.isLeft=!0,r+=n.bound.clientHeight+i.config.heightSpac,u+=n.bound.clientWidth):(n.isRight=!0,a+=n.bound.clientHeight+i.config.heightSpac,g+=n.bound.clientWidth):(c+=n.bound.clientHeight,n.bound.clientWidth>l&&(l=n.bound.clientWidth))})),0===e.level?(r=(r-=this.config.heightSpac)>n.clientHeight?r:n.clientHeight,a=(a-=this.config.heightSpac)>n.clientHeight?a:n.clientHeight,n.leftHeight=r,n.rightHeight=a,n.leftWidht=u,n.rightWidth=g,n.clientWidth=u+g+n.width+2*this.config.widthSpac):(c=(c+=(d-1)*this.config.heightSpac)>n.clientHeight?c:n.clientHeight,l+=n.clientWidth+this.config.widthSpac,n.clientWidth=l,n.clientHeight=c)}e.bound=n},t}()}();
